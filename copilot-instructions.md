# Remix フルスタックテンプレート用 GitHub Copilot 説明書

## プロジェクト概要

これはモダンな開発プラクティスを備えた本格的なRemixフルスタックテンプレートです。技術スタックには以下が含まれます：

- **フレームワーク**: TypeScriptとViteを使用したRemix
- **データベース**: Prisma ORMを使用したPostgreSQL
- **認証**: GoogleとGitHub OAuthを使用したremix-auth
- **UI**: shadcn/uiコンポーネントを使用したTailwind CSS
- **テスト**: Vitest（ユニット）とPlaywright（e2e）
- **開発**: Dockerサポート付きDevContainer
- **デプロイメント**: GitHub Actions CI/CDを使用したFirebase Hosting
- **コード品質**: リントとフォーマット用Biome

## アーキテクチャ原則

### Remix哲学
- デフォルトでサーバーサイドレンダリング
- プログレッシブエンハンスメント
- 抽象化よりもWeb標準
- フォームを通じたデータミューテーション
- より良いUXのためのネストルーティング

### コード構成
```
app/
├── components/        # 再利用可能なUIコンポーネント
│   └── ui/           # shadcn/uiコンポーネント
├── lib/              # サーバーサイドユーティリティ
├── routes/           # Remixルート（ファイルベースルーティング）
├── styles/           # グローバルスタイル
└── utils/            # クライアントサイドユーティリティ
```

### 開発パターン
- サーバー専用コードには`*.server.ts`サフィックスを使用
- データ取得には`loader`関数を優先
- ミューテーションには`action`関数を使用
- 楽観的更新には`useFetcher`を活用
- Remixのデータフローパターンに従う

## 主要ガイドライン

### 認証
- ユーザーはOAuth（Google/GitHub）で認証
- ローダーで`authenticator.isAuthenticated()`を使用
- 未認証ユーザーを`/login`にリダイレクト
- ユーザーデータをPrismaデータベースに保存

### データベース
- 型安全なデータベース操作にPrismaを使用
- `~/lib/db.server.ts`からインポート
- データ分離のためクエリに常にユーザーIDを含める
- 複雑な操作にはトランザクションを使用

### UIコンポーネント
- `~/components/ui/`のshadcn/uiコンポーネントを使用
- prop drillingよりもコンポジションを優先
- スタイリングにTailwind CSSを使用
- アクセシビリティのベストプラクティスに従う

### テスト
- `*.test.ts`ファイルでVitestを使用してユニットテストを作成
- `e2e/`ディレクトリでPlaywrightを使用してE2Eテスト
- 実装詳細ではなくユーザーフローをテスト
- 一貫したテスト環境にDockerを使用

### 環境セットアップ
- ローカル開発用に`.env.example`を`.env`にコピー
- 認証用にOAuthプロバイダーを設定
- ローカルデータベース用にDocker Composeを使用
- DevContainerが一貫した開発環境を提供

## 一般的なタスク

### 新しいルートの追加
1. `app/routes/`にファイルを作成
2. データ取得用に`loader`をエクスポート
3. ミューテーション用に`action`をエクスポート
4. デフォルトコンポーネントをエクスポート
5. 必要に応じて認証を追加

### 新しいコンポーネントの追加
1. `app/components/`に作成
2. プロパティ用にTypeScriptインターフェースを使用
3. UIコンポーネントにはshadcn/uiパターンに従う
4. 適切なインデックスファイルからエクスポート

### データベース変更
1. `prisma/schema.prisma`を更新
2. 開発環境では`yarn db:push`を実行
3. 本番環境では`yarn db:migrate`を実行
4. 型は自動生成されます

### デプロイメント
1. mainブランチにプッシュ
2. GitHub Actionsがテストを実行
3. Firebase Hostingにデプロイ
4. GitHub Secretsで環境変数を設定

## ベストプラクティス

### コードスタイル
- フォーマットとリント用にBiomeを使用
- バレルエクスポートより明示的インポートを優先
- 意味のある変数名を使用
- 複雑な関数にはJSDocコメントを追加

### セキュリティ
- クライアントコードでシークレットを公開しない
- すべてのユーザー入力を検証
- CSRF保護を使用（Remixに組み込み）
- データベースクエリをサニタイズ（Prismaが処理）

### パフォーマンス
- Remixの組み込み最適化を使用
- ブラウザキャッシュを活用
- データベースクエリを最適化
- 適切なエラーバウンダリを使用

### アクセシビリティ
- セマンティックHTMLを使用
- 必要な場所にARIAラベルを追加
- キーボードナビゲーションでテスト
- 適切なカラーコントラストを確保

## 開発ワークフロー

1. 一貫した環境のためにDevContainerで開く
2. `.env.example`を`.env`にコピーして設定
3. `yarn dev`を実行して開発サーバーを開始
4. 変更を加えてローカルでテスト
5. `yarn test`と`yarn test:e2e`でテストを実行
6. レビュー用にPRを作成
7. mainにマージで自動デプロイ

## トラブルシューティング

### よくある問題
- **データベース接続**: .envのDATABASE_URLを確認
- **認証**: OAuth認証情報とコールバックURLを確認
- **ビルドエラー**: TypeScript型とインポートを確認
- **テスト失敗**: テストデータベースが実行されていることを確認

### デバッグ
- クライアントサイドの問題にはブラウザ開発者ツールを使用
- バックエンドの問題にはサーバーログを確認
- データベース検査にはPrisma Studioを使用
- 開発環境でRemix開発者ツールを有効化

注意：このテンプレートは、モダンなWeb標準とRemix規約に従いながら、シンプルさ、型安全性、開発者エクスペリエンスを優先します。
